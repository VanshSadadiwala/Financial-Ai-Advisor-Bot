<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #020202; /* Almost black */
            color: #e0e0e0; /* Light grey text for contrast */
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        input {
            width: 60%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: none;
            text-align: center;
        }
        .buttons button, .forecast-buttons button {
            margin: 5px;
            margin-bottom: 40px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: rgb(255, 255, 255);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .buttons button:hover, .forecast-buttons button:hover {
            background-color: rgb(78, 147, 220);
        }
        .buttons button.active-button, .forecast-buttons button.active-button {
            background-color: #00ffcc !important;
            color: #000 !important;
        }
        .main-chart {
            flex: 2;
        }
        .chart-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(47, 55, 57, 0.9); /* Semi-transparent dark grey */
            border-radius: 10px;
            padding: 20px;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px #00ffcc, 0 0 40px #00ffcc;
        }

        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #1a1a1a;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .menu-toggle {
            font-size: 24px;
            cursor: pointer;
            color: #fff;
        }

        .nav-title {
            font-size: 24px;
            color: #fff;
            margin: 0;
            transition: all 0.3s ease;
        }

        .nav-right .back-btn {
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Sidebar styles */
        .sidebar {
            position: fixed;
            left: -250px;
            top: 0;
            width: 250px;
            height: 100%;
            background-color: #1a1a1a;
            padding-top: 70px;
            transition: 0.3s;
            z-index: 999;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-item {
            padding: 1rem 2rem;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
            position: relative;
        }

        .sidebar-item:hover {
            background-color: rgba(0, 255, 204, 0.1);
        }

        .sidebar-item.active {
            background-color: rgba(0, 255, 204, 0.2);
            color: #00ffcc;
        }

        /* Updated search container styles */
        .search-container {
            position: relative;
            width: 60%;
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 10px;
            margin: 80px auto 0;
        }

        .search-container input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            text-align: left;
            height: 45px;
            box-sizing: border-box;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 35%;
            transform: translateY(-50%);
            color: #666;
            cursor: pointer;
        }

        /* New buttons styles */
        .buttons {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px 0;
            margin: 10px 0;
        }

        /* Remove any extra margins from container */
        .container > * {
            margin-bottom: 0;
        }

        .chart-container {
            margin-top: 10px;
        }


        .trading-view {
            width: 100%;
            margin-bottom: 20px;
        }

        .main-chart {
            height: 500px !important;
            margin-bottom: 0;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
        }

        .volume-chart {
            height: 100px !important;
            margin-top: 20px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
        }

        .secondary-charts {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .trend-chart, .range-chart {
            flex: 1;
            height: 300px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
        }

        .stats-panel {
            display: flex;
            gap: 20px;
            justify-content: space-between;
            margin-top: 20px;
        }

        .stat-card {
            flex: 1;
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h3 {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .stat-card p {
            margin: 10px 0 0;
            font-size: 18px;
            color: #fff;
        }

        /* Chart Tooltips */
        .chartjs-tooltip {
            background: rgba(0, 0, 0, 0.8) !important;
            border-radius: 4px !important;
            padding: 8px !important;
        }

        canvas {
            background: #0a0e17;
        }

        /* Card or container styles */
        .card, .graph-container {
            background: rgba(26, 26, 26, 0.9); /* Semi-transparent dark grey */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Soft shadow */
            padding: 20px;
            margin: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        /* Button styles */
        button:hover {
            background-color: rgb(78, 189, 220); 
        }

        /* Graph styles with enhanced gradient and elevation */
        .graph {
            background: #1a1a1a; /* Dark grey */
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            padding: 25px;
            transition: transform 0.4s, box-shadow 0.4s, background 0.4s;
        }

        /* Hover effect for graphs */
        .graph:hover {
            transform: translateY(-10px); /* Elevate the block */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
            background: linear-gradient(135deg, #1a1a1a, #00ffcc); /* Gradient effect */
        }

        /* Duration button styles */
        .duration-button {
            background-color: #1a1a1a; /* Match graph background */
            color: #e0e0e0; /* Light grey text */
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: none; /* Remove glow effect */
        }

        .duration-button:hover {
            background-color: #333333; /* Slightly lighter on hover */
        }

        /* Additional styles for layout */
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;
        }

        /* Add this to your existing CSS */
        .active-button {
            background-color: #00ffcc !important; /* Change the button color */
            color: #000 !important; /* Optional: Change text color for contrast */
        }

        /* Content Container Styles */
        .content-container {
            display: none;
            width: 100%;
            margin-top: 20px;
        }

        .content-container.active {
            display: block;
        }

        /* Hide search container for non-stock analysis views */
        #futureForecastingContainer .search-container,
        #newsContainer .search-container {
            display: none;
        }
        #futureForecastingContainer{
            margin-top: 80px;
            width: 100%;
        }
        /* Ensure proper spacing */
        .chart-container {
            margin-top: 20px;
        }

        /* News Grid Styles */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            margin-top: 80px;
        }

        .news-card {
            background: rgba(26, 26, 26, 0.9);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 255, 204, 0.2);
        }

        .news-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .news-content {
            padding: 15px;
        }

        .news-content h3 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 1.1em;
            line-height: 1.4;
        }

        .news-content p {
            color: #ccc;
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.8em;
            color: #888;
        }

        .news-source {
            color: #00ffcc;
            font-weight: bold;
        }

        .news-date {
            color: #888;
        }

        .read-more {
            display: inline-block;
            padding: 8px 16px;
            background-color: #00ffcc;
            color: #000;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .read-more:hover {
            background-color: #00cc99;
        }

        .error-message {
            color: #ff4444;
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
        }

        /* Forecast specific styles */
        .forecast-buttons {
            margin-bottom: 20px;
        }

        .forecast-buttons button {
            background-color: #1a1a1a;
            color: #e0e0e0;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .forecast-buttons button:hover {
            background-color: rgba(0, 255, 204, 0.1);
        }

        .forecast-buttons button.active-button {
            background-color: #00ffcc;
            color: #000;
        }

        #forecastChart {
            background: #0a0e17;
        }

        /* Ensure consistent styling between both sections */
        #futureForecastingContainer .search-container {
            display: flex;
            margin-bottom: 20px;
            width: 60%;
            margin: 80px auto 0;
        }

        #futureForecastingContainer .chart-container {
            background: rgba(47, 55, 57, 0.9);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 20px #00ffcc, 0 0 40px #00ffcc;
        }

        .market-session-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .market-session-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .market-session-btn:hover {
            background: #f0f0f0;
        }

        .market-session-btn.active {
            background: #00ffcc;
            color: #000;
            border-color: #00ffcc;
        }

    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <i class="fas fa-bars menu-toggle"></i>
            <h1 class="nav-title" id="navTitle">Stock Analysis Dashboard</h1>
        </div>
        <div class="nav-right">
            <a href="../index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Website
            </a>
        </div>
    </nav>

    <div class="sidebar">
        <a href="#" class="sidebar-item active" data-title="Stock Analysis Dashboard" data-target="stockAnalysisContainer">
            <i class="fas fa-chart-line"></i>
            <span>Stock Analysis</span>
        </a>
        <a href="#" class="sidebar-item" data-title="Future Forecasting Dashboard" data-target="futureForecastingContainer">
            <i class="fas fa-forward"></i>
            <span>Future Forecasting</span>
        </a>
        <a href="#" class="sidebar-item" data-title="News Dashboard" data-target="newsContainer">
            <i class="fas fa-newspaper"></i>
            <span>News</span>
        </a>
    </div>

    <!-- Main content area -->
    <div class="search-container">
        <input type="text" id="stockInput" placeholder="Enter company name or ticker">
        <i class="fas fa-search search-icon"></i>
    </div>

    <!-- Stock Analysis Container -->
    <div id="stockAnalysisContainer" class="content-container active">
        <div class="buttons">
            <button data-interval="1min" onclick="updateTimeframe('1min')">1 Hour</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'pre')">Pre Market</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'regular')">Regular Market</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'after')">After Market</button>
            <button data-interval="60min" onclick="updateTimeframe('60min')">5 Days</button>
            <button data-interval="1day" onclick="updateTimeframe('1day')">1 Month</button>
            <button data-interval="1day" onclick="updateTimeframe('1day', null, '3month')">3 Months</button>
            <button data-interval="1week" onclick="updateTimeframe('1week')">6 Months</button>
            <button data-interval="1week" onclick="updateTimeframe('1week', null, '1year')">1 Year</button>
            <button data-interval="1month" onclick="updateTimeframe('1month', null, '4year')">4 Years</button>
            <button data-interval="1month" onclick="updateTimeframe('1month', null, '8year')">8 Years</button>
        </div>
        
        <div class="chart-container">
            <!-- Main Trading View Section -->
            <div class="trading-view">
                <!-- Candlestick Chart -->
                <div class="main-chart">
                    <canvas id="candlestickChart"></canvas>
                </div>
                
                <!-- Volume Chart -->
                <div class="volume-chart">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>

            <!-- Secondary Charts Section -->
            <div class="secondary-charts">
                <!-- Line Trend Chart -->
                <div class="trend-chart">
                    <canvas id="trendChart"></canvas>
                </div>
                
                <!-- Price Range Chart -->
                <div class="range-chart">
                    <canvas id="rangeChart"></canvas>
                </div>
            </div>

            <!-- Stats Panel -->
            <div class="stats-panel">
                <div class="stat-card">
                    <h3>Current Price</h3>
                    <p id="currentPrice">$0.00</p>
                </div>
                <div class="stat-card">
                    <h3>Day's Range</h3>
                    <p id="dayRange">$0.00 - $0.00</p>
                </div>
                <div class="stat-card">
                    <h3>Volume</h3>
                    <p id="volume">0</p>
                </div>
                <div class="stat-card">
                    <h3>Change</h3>
                    <p id="priceChange">0.00%</p>
                </div>
            </div>
        </div>
    </div>

    <div class="loading">
        <div class="spinner"></div>
    </div>

    <!-- --------------------------------------------------------------------------------------------------------------------- -->
    <!-- Future Forecasting Container -->
    <div id="futureForecastingContainer" class="content-container">
        <div class="search-container">
            <input type="text" id="forecastInput" placeholder="Enter company name or ticker for forecast">
            <i class="fas fa-search forecast-search-icon"></i>
        </div>

        <div class="buttons forecast-buttons">
            <button data-interval="1min" onclick="updateTimeframe('1min')">1 Hour</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'pre')">Pre Market</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'regular')">Regular Market</button>
            <button data-interval="5min" onclick="updateTimeframe('5min', 'after')">After Market</button>
            <button data-interval="60min" onclick="updateTimeframe('60min')">5 Days</button>
            <button data-interval="1day" onclick="updateTimeframe('1day')">1 Month</button>
            <button data-interval="1week" onclick="updateTimeframe('1week')">6 Months</button>
            <button data-interval="1week" onclick="updateTimeframe('1week', null, '1year')">1 Year</button>
            <button data-interval="1month" onclick="updateTimeframe('1month', null, '4year')">4 Years</button>
            <button data-interval="1month" onclick="updateTimeframe('1month', null, '8year')">8 Years</button>
        </div>
        
        <div class="chart-container">
            <div class="main-chart">
                <canvas id="forecastChart"></canvas>
            </div>
            
            <!-- Add stats panel for forecast -->
            <div class="stats-panel">
                <div class="stat-card">
                    <h3>Predicted Price</h3>
                    <p id="predictedPrice">$0.00</p>
                </div>
                <div class="stat-card">
                    <h3>Prediction Range</h3>
                    <p id="predictionRange">$0.00 - $0.00</p>
                </div>
                <div class="stat-card">
                    <h3>Confidence Level</h3>
                    <p id="confidenceLevel">0%</p>
                </div>
                <div class="stat-card">
                    <h3>Predicted Change</h3>
                    <p id="predictedChange">0.00%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- News Container -->
    <div id="newsContainer" class="content-container">
        <div class="news-grid">
            <!-- News cards will be dynamically inserted here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.querySelector('.menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const navTitle = document.getElementById('navTitle');
            const searchContainer = document.querySelector('.search-container');
            const stockInput = document.getElementById('stockInput');
            let mainChart, volumeChart, trendChart, rangeChart, forecastChart;

            // Initialize all charts
            function initializeCharts() {
                const tradingColors = {
                    background: '#7b7880',      
                    line: '#2962FF',           // Bright blue line
                    text: '#e1e1e1',           
                    grid: '#1c2230',           
                    tooltip: '#131722',
                    up: '#22ab94',            // Green for up movement
                    down: '#f23645'           // Red for down movement
                };

                const ctx = document.getElementById('candlestickChart').getContext('2d');
                mainChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Price',
                            data: [],
                            borderColor: tradingColors.line,
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            pointHoverBackgroundColor: tradingColors.line,
                            pointHoverBorderColor: '#fff',
                            pointHoverBorderWidth: 2,
                            tension: 0.1
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: tradingColors.grid
                                },
                                ticks: {
                                    color: tradingColors.text,
                                    font: {
                                        size: 11
                                    }
                                },
                                reverse: true
                            },
                            y: {
                                position: 'left',
                                grid: {
                                    color: tradingColors.grid
                                },
                                ticks: {
                                    color: tradingColors.text,
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: tradingColors.tooltip,
                                titleColor: tradingColors.text,
                                bodyColor: tradingColors.text,
                                borderColor: tradingColors.grid,
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    title: function(tooltipItems) {
                                        return 'Date: ' + tooltipItems[0].label;
                                    },
                                    label: function(context) {
                                        const i = context.dataIndex;
                                        const data = context.dataset.data[i];
                                        const priceChange = data.close - data.open;
                                        const percentChange = (priceChange / data.open * 100).toFixed(2);
                                        const color = priceChange >= 0 ? tradingColors.up : tradingColors.down;
                                        
                                        return [
                                            `Open: $${data.open.toFixed(2)}`,
                                            `High: $${data.high.toFixed(2)}`,
                                            `Low: $${data.low.toFixed(2)}`,
                                            `Close: $${data.close.toFixed(2)}`,
                                            `Change: ${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)} (${percentChange}%)`
                                        ];
                                    }
                                }
                            }
                        }
                    },
                });

                const volumeCtx = document.getElementById('volumeChart').getContext('2d');
                volumeChart = new Chart(volumeCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Volume',
                            data: [],
                            backgroundColor: tradingColors.backgroundColor,
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        scales: {
                            x: {
                                display: false
                            },
                            y: {
                                position: 'left',
                                grid: {
                                    color: tradingColors.grid
                                },
                                ticks: {
                                    color: tradingColors.text
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    },
                });

                const trendCtx = document.getElementById('trendChart').getContext('2d');
                trendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Price Trend',
                            data: [],
                            borderColor: '#FF1493',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4,
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#FFFFFF' }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#FFFFFF' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#FFFFFF' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            }
                        }
                    },
                });

                const rangeCtx = document.getElementById('rangeChart').getContext('2d');
                rangeChart = new Chart(rangeCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Price Range',
                            data: [],
                            backgroundColor: '#00FFFF',
                            borderColor: '#FFFFFF',
                            borderWidth: 1
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#FFFFFF' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const i = context.dataIndex;
                                        return [
                                            `High: ${context.raw[i]}`,
                                            `Low: ${context.raw[i]}`,
                                            `Range: ${context.raw[i] - context.raw[i]}`
                                        ];
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#FFFFFF' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#FFFFFF' },
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }
                            }
                        }
                    },
                });
            }

            // Initialize Forecast Chart
            function initializeForecastChart() {
                const ctx = document.getElementById('forecastChart').getContext('2d');
                forecastChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Historical Price',
                            data: [],
                            borderColor: '#00ffcc',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            fill: false
                        },
                        {
                            label: 'Forecast',
                            data: [],
                            borderColor: '#FF1493',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            borderDash: [5, 5],
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#fff'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#fff'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
            }

            // Initialize all charts
            initializeCharts();
            initializeForecastChart();

            // Function to update charts timeframe
            function updateChartsTimeframe(period, session = 'regular', timePeriod = null) {
                const symbol = stockInput.value.trim();
                if (!symbol) {
                    alert('Please enter a company name or ticker symbol.');
                    return;
                }
                if (symbol) {
                    fetchAndUpdateData(symbol, period, session, timePeriod);
                }
            }

            // Function to fetch and update data
            async function fetchAndUpdateData(symbol, duration, session = 'regular', period = null) {
                try {
                    document.querySelector('.loading').classList.add('active');
                    
                    let url = `http://127.0.0.1:5000/stock-data?symbol=${symbol}&duration=${duration}&session=${session}`;
                    if (period) {
                        url += `&period=${period}`;
                    }
                    
                    const response = await fetch(url);
                    const jsonData = await response.json();

                    document.querySelector('.loading').classList.remove('active');

                    if (!Array.isArray(jsonData)) {
                        alert(jsonData.error || 'Invalid data received from server.');
                        return;
                    }

                    if (jsonData.length === 0) {
                        alert('No data available for the selected period.');
                        return;
                    }
                    
                    jsonData.sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
                    
                    // Format data for charts
                    const dates = jsonData.map(entry => entry.datetime);
                    const formattedData = jsonData.map(entry => ({
                        open: Number(entry.open),
                        high: Number(entry.high),
                        low: Number(entry.low),
                        close: Number(entry.close),
                        volume: Number(entry.volume)
                    }));
                    
                    // Update main chart with formatted data
                    mainChart.data.labels = dates;
                    mainChart.data.datasets[0].data = formattedData;
                    mainChart.update();
                    
                    // Update volume chart
                    volumeChart.data.labels = dates;
                    volumeChart.data.datasets[0].data = formattedData.map(d => d.volume);
                    volumeChart.update();
                    
                    // Update trend chart
                    trendChart.data.labels = dates;
                    trendChart.data.datasets[0].data = formattedData.map(d => d.close);
                    trendChart.update();
                    
                    // Update range chart
                    const ranges = formattedData.map(d => d.high - d.low);
                    rangeChart.data.labels = dates;
                    rangeChart.data.datasets[0].data = ranges;
                    rangeChart.update();
                    
                    // Update stats panel
                    const latestData = formattedData[formattedData.length - 1];
                    document.getElementById('currentPrice').textContent = `$${latestData.close.toFixed(2)}`;
                    document.getElementById('dayRange').textContent = 
                        `$${Math.min(...formattedData.map(d => d.low)).toFixed(2)} - $${Math.max(...formattedData.map(d => d.high)).toFixed(2)}`;
                    document.getElementById('volume').textContent = 
                        formattedData.reduce((a, b) => a + b.volume, 0).toLocaleString();
                    
                    const priceChange = latestData.close - latestData.open;
                    const percentChange = (priceChange / latestData.open * 100).toFixed(2);
                    document.getElementById('priceChange').textContent = 
                        `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)} (${percentChange}%)`;

                } catch (error) {
                    console.error('Error fetching data:', error);
                    alert('An error occurred while fetching data.');
                }
            }

            // Sidebar toggle functionality
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            // Add click events to sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Remove active class from all sidebar items
                    document.querySelectorAll('.sidebar-item').forEach(sideItem => {
                        sideItem.classList.remove('active');
                    });

                    // Add active class to clicked item
                    this.classList.add('active');

                    // Update navbar title
                    const newTitle = this.getAttribute('data-title');
                    navTitle.textContent = newTitle;

                    // Hide all containers first
                    document.querySelectorAll('.content-container').forEach(container => {
                        container.classList.remove('active');
                    });

                    // Show selected container
                    const targetId = this.getAttribute('data-target');
                    const targetContainer = document.getElementById(targetId);
                    targetContainer.classList.add('active');

                    // Show/hide search container based on selected view
                    if (targetId === 'stockAnalysisContainer') {
                        searchContainer.style.display = 'flex';
                    } else {
                        searchContainer.style.display = 'none';
                    }

                    // Fetch news when news tab is clicked
                    if (targetId === 'newsContainer') {
                        fetchAndDisplayNews();
                    }

                    // Close sidebar after selection
                    sidebar.classList.remove('active');
                });
            });

            // Add event listeners for duration buttons
            document.querySelectorAll('.buttons button').forEach(button => {
                button.addEventListener('click', function () {
                    // Remove active class from all buttons
                    document.querySelectorAll('.buttons button').forEach(btn => btn.classList.remove('active-button'));
                    
                    // Add active class to the clicked button
                    this.classList.add('active-button');

                    // Update charts timeframe
                    const period = this.getAttribute('data-interval');
                    updateChartsTimeframe(period);
                });
            });

            // Search functionality on Enter key or search icon click
            const searchIcon = document.querySelector('.search-icon');
            searchIcon.addEventListener('click', () => updateChartsTimeframe(document.querySelector('.buttons button').dataset.interval));
            
            stockInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') updateChartsTimeframe(document.querySelector('.buttons button').dataset.interval);
            });

            // Global function for onclick handlers in HTML buttons
            window.updateTimeframe = updateChartsTimeframe;

            // Add this function to fetch and display news
            async function fetchAndDisplayNews() {
                try {
                    const response = await fetch('https://finnhub.io/api/v1/news?category=general&token=cvm3r89r01qnndmbus70cvm3r89r01qnndmbus7g');
                    const newsData = await response.json();
                    
                    const newsGrid = document.querySelector('.news-grid');
                    newsGrid.innerHTML = ''; // Clear existing news

                    newsData.forEach(news => {
                        const newsCard = document.createElement('div');
                        newsCard.className = 'news-card';
                        
                        // Convert Unix timestamp to readable date
                        const date = new Date(news.datetime * 1000).toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });

                        newsCard.innerHTML = `
                            <img src="${news.image}" alt="${news.headline}" onerror="this.src='https://via.placeholder.com/400x200?text=No+Image'">
                            <div class="news-content">
                                <h3>${news.headline}</h3>
                                <p>${news.summary}</p>
                                <div class="news-meta">
                                    <span class="news-source">${news.source}</span>
                                    <span class="news-date">${date}</span>
                                </div>
                                <a href="${news.url}" target="_blank" class="read-more">Read More</a>
                            </div>
                        `;
                        
                        newsGrid.appendChild(newsCard);
                    });
                } catch (error) {
                    console.error('Error fetching news:', error);
                    document.querySelector('.news-grid').innerHTML = '<p class="error-message">Failed to load news. Please try again later.</p>';
                }
            }
        });
    </script>
</body>
</html>